<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>kubectl-execrec: Session Recording for kubectl exec for auditing and compliance with security - Xing Yahao</title><link rel="icon" type="image/png" href=https://xingyahao.com/favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="The plugin was created to address the gap in Kubernetes audit logs, which only capture API calls but not session content. Unlike complex tools like Falco, this solution focuses on simplicity, recording kubectl exec sessions for security and compliance without requiring significant changes to existing workflows or additional infrastructure." />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://xingyahao.com/posts/kubectl-execrec-session-recording-for-kubectl-exec-for-auditing-and-compliance-with-security/">
  <meta property="og:site_name" content="Xing Yahao">
  <meta property="og:title" content="kubectl-execrec: Session Recording for kubectl exec for auditing and compliance with security">
  <meta property="og:description" content="The plugin was created to address the gap in Kubernetes audit logs, which only capture API calls but not session content. Unlike complex tools like Falco, this solution focuses on simplicity, recording kubectl exec sessions for security and compliance without requiring significant changes to existing workflows or additional infrastructure.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-11T18:23:00+09:00">
    <meta property="article:modified_time" content="2025-08-11T18:23:00+09:00">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="kubectl-execrec: Session Recording for kubectl exec for auditing and compliance with security">
  <meta name="twitter:description" content="The plugin was created to address the gap in Kubernetes audit logs, which only capture API calls but not session content. Unlike complex tools like Falco, this solution focuses on simplicity, recording kubectl exec sessions for security and compliance without requiring significant changes to existing workflows or additional infrastructure.">
<script src="https://xingyahao.com/js/feather.min.js"></script>
	
	
        <link href="https://xingyahao.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://xingyahao.com/css/main.5cebd7d4fb2b97856af8d32a6def16164fcf7d844e98e236fcb3559655020373.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://xingyahao.com/css/dark.d22e2a2879d933a4b781535fc4c4c716e9f9d35ea4986dd0cbabda82effc4bdd.css"  disabled />
	

	
	

	
	

	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://xingyahao.com/">Xing Yahao</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="https://xingyahao.com/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">kubectl-execrec: Session Recording for kubectl exec for auditing and compliance with security</h1>
			<div class="meta">Posted on Aug 11, 2025</div>
		</div>
		

		

		<section class="body">
			<p><img src="https://miro.medium.com/v2/resize:fit:700/1*xpNw34UIvHmnt-4OLl-G3Q.png" alt="intro-image-created-by-chatgpt.png"></p>
<h2 id="why-i-created-this-plugin">Why I Created This Plugin</h2>
<p><a href="https://github.com/keidarc/kubectl-execrec">https://github.com/keidarc/kubectl-execrec</a></p>
<p>Kubernetes has built-in audit logs, but they only capture API calls, not the actual session content. When you use <code>kubectl exec</code>, you get audit entries showing who accessed which pod, but not what commands were run or what output was produced.</p>
<p>For comprehensive security monitoring, tools like <a href="https://falco.org/">Falco</a> provide real-time threat detection across containers and Kubernetes. However, these are heavy solutions designed for enterprise security teams.</p>
<p>I wanted something simpler: just record <code>kubectl exec</code> sessions with minimal changes to existing workflows. No complex setup, no additional infrastructure, just session recording when you need it for security and compliance.</p>
<h2 id="solution-kubectl-execrec">Solution: <a href="https://github.com/keidarc/kubectl-execrec">kubectl-execrec</a></h2>
<p><strong>execrec</strong> = <strong>exec</strong> + <strong>rec</strong>order</p>
<p>A transparent wrapper around <code>kubectl exec</code> that automatically logs all sessions to timestamped files for security auditing and compliance. This is a simple and lightweight solution that can be used by anyone to record their <code>kubectl exec</code> sessions and logs are saved to the local filesystem with optional to storage services like S3.</p>
<h2 id="how-it-works">How It Works</h2>
<p>The plugin acts as a transparent wrapper around <code>kubectl exec</code>. When you run <code>kubectl execrec</code>, it:</p>
<ol>
<li>Creates a log file with session metadata</li>
<li>Starts the actual <code>kubectl exec</code> command with a pseudo-terminal</li>
<li>Captures all input/output and writes to both your terminal and the log file</li>
<li>Handles signals like Ctrl+C properly</li>
<li>Closes the session and finalizes the log file</li>
<li>Uploads the log file to the storage service if configured</li>
</ol>
<p>The key is that it&rsquo;s completely transparent. You use it exactly like <code>kubectl exec</code>, but everything gets recorded automatically.</p>
<h2 id="features">Features</h2>
<h3 id="transparent-wrapper">Transparent Wrapper</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#928374;font-style:italic"># Instead of:</span>
</span></span><span style="display:flex;"><span>kubectl <span style="color:#fabd2f">exec</span> -n default my-pod -it -- bash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#928374;font-style:italic"># Use:</span>
</span></span><span style="display:flex;"><span>kubectl execrec -n default my-pod -it -- bash
</span></span></code></pre></div><p>All flags, arguments, and behavior remain identical while providing complete session security logging.</p>
<h3 id="log-format">Log Format</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>[command] kubectl execrec -n default my-pod -it -- bash
</span></span><span style="display:flex;"><span>[session] start=2025-08-10T14:33:32+09:00 user=username
</span></span><span style="display:flex;"><span>================================================================================
</span></span><span style="display:flex;"><span>root@my-pod:/app# ls -la
</span></span><span style="display:flex;"><span>total 1234
</span></span><span style="display:flex;"><span>drwxr-xr-x 1 root root 4096 Aug 10 14:33 .
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 root root  123 Aug 10 14:33 file.txt
</span></span><span style="display:flex;"><span>root@my-pod:/app# cat file.txt
</span></span><span style="display:flex;"><span>Hello, World!
</span></span><span style="display:flex;"><span>root@my-pod:/app# exit
</span></span><span style="display:flex;"><span>================================================================================
</span></span><span style="display:flex;"><span>[session] end=2025-08-10T14:35:12+09:00
</span></span></code></pre></div><h3 id="storage-service-integrations3-compatible-storage-is-only-supported-at-the-moment">Storage Service Integration(S3 compatible storage is only supported at the moment)</h3>
<div class="highlight"><pre tabindex="0" style="color:#ebdbb2;background-color:#282828;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#fabd2f">export</span> KUBECTL_EXECREC_S3_BUCKET<span style="color:#fe8019">=</span>my-logs-bucket
</span></span><span style="display:flex;"><span><span style="color:#fabd2f">export</span> KUBECTL_EXECREC_S3_ENDPOINT<span style="color:#fe8019">=</span>http://localhost:9000  <span style="color:#928374;font-style:italic"># MinIO as an example</span>
</span></span><span style="display:flex;"><span>kubectl execrec -n default my-pod -it -- bash
</span></span></code></pre></div>
		</section>

		<div class="post-tags">
			
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/keidarcy" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://www.linkedin.com/in/xingyahao" rel="me" title="Linkedin"><i data-feather="linkedin"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2025  Â© Xing Yahao |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FGTFKPMCX2"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FGTFKPMCX2');
        }
      </script>
<script>
  feather.replace()
</script></div>
    </body>
</html>
