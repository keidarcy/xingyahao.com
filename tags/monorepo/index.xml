<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Monorepo on Xing Yahao</title>
    <link>https://xingyahao.com/tags/monorepo/</link>
    <description>Recent content in Monorepo on Xing Yahao</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <copyright>© Xing Yahao</copyright>
    <lastBuildDate>Mon, 16 Jan 2023 09:25:36 +0900</lastBuildDate>
    <atom:link href="https://xingyahao.com/tags/monorepo/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Javascript Monorepo Development Improvement Approaches</title>
      <link>https://xingyahao.com/posts/javascript-monorepo-development-improvement-approaches/</link>
      <pubDate>Mon, 16 Jan 2023 09:25:36 +0900</pubDate>
      <guid>https://xingyahao.com/posts/javascript-monorepo-development-improvement-approaches/</guid>
      <description>&lt;p&gt;Monorepo (monorepo) refers to a pattern where all code of an application or microservice is stored in a single monolithic repository (usually Git).&lt;/p&gt;&#xA;&lt;p&gt;Until now, both backend and frontend have been managed in the same repository, the so-called JavaScript monorepo. The &lt;a href=&#34;https://classic.yarnpkg.com/en/docs/yarn-workflow&#34;&gt;yarn workspace&lt;/a&gt; function is mainly used to share the backend/frontend and logic code, and also to avoid the need to switch between the two repositories. No more need to send out code reviews to multiple repositories. We were able to develop quickly because we only needed to clone and modify one repository.&lt;/p&gt;</description>
    </item>
    <item>
      <title>JavaScript Monorepo 開発改善への取り組みについて(Japanese)</title>
      <link>https://xingyahao.com/posts/javascript-monorepo-development-improvement-approaches-ja/</link>
      <pubDate>Fri, 16 Dec 2022 09:25:36 +0900</pubDate>
      <guid>https://xingyahao.com/posts/javascript-monorepo-development-improvement-approaches-ja/</guid>
      <description>&lt;p&gt;Monorepo(モノレポ)とは、アプリケーションやマイクロサービスの全コードを単一のモノリシックなリポジトリ (普通は Git) に保存するパターンを指します。&lt;/p&gt;&#xA;&lt;p&gt;今まで backend/frontend ともに JavaScript で同じリポジトリで管理されて、いわゆる JavaScript の モノレポです。主に &lt;a href=&#34;https://classic.yarnpkg.com/en/docs/yarn-workflow&#34;&gt;yarn workspace&lt;/a&gt; 機能を使って、backend/frontend とロジックのコードをシェアーして、また、それぞれのレポジトリの切り替えが必要なく、コードレビューを複数に出す必要もなくなりました。一つのリポジトリさえクローンして修正すればいいので、素早く開発できました。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://storage.googleapis.com/zenn-user-upload/0b6954535479-20240604.png&#34; alt=&#34;Multi-Repo vs Monorepo&#34; loading=&#34;lazy&#34; decoding=&#34;async&#34;&gt;&#xA;&lt;/p&gt;&#xA;&lt;p&gt;しかし、一年前状況を振り返ったら、二つ大きな問題点があります。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://classic.yarnpkg.com/lang/en/&#34;&gt;yarn 1&lt;/a&gt; (以降 yarn と呼びます)の機能不足(詳細は&lt;a href=&#34;https://xingyahao.com/posts/npm-yarn-pnpm-ja/&#34;&gt;去年の記事&lt;/a&gt;)で新規プロジェクトを同じリポジトリに workspace の package として作れないこと。&lt;/li&gt;&#xA;&lt;li&gt;環境のローカルサーバが立ち上がるのが 120 秒以上かかるなど開発者体験が悪いことです。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;チーム内に一度今後の構成について、モノレポかマルチレポか議論が上がりましたが、その時はプロジェクトのスケジュールを優先してマルチレポを選びました。しかし共通コンポーネントが共有しづらいとか、複数のレポジトリにまたがる開発のコードレビューが難しいとか、開発の効率がモノレポより下がっていることがわかっていました。&lt;/p&gt;&#xA;&lt;p&gt;これら改善のタスクは私のチームに任させて、今年に色々施策して、改善してきました。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;新規の package を元のモノレポ配下に作ることができて、既存のロジックなどを簡易に再利用できました。&lt;/li&gt;&#xA;&lt;li&gt;ローカルサーバの立ち上がる時間は元の50%まで激減して、開発者体験向上や開発スピードが上がりました。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;様々な取り組み&#34;&gt;様々な取り組み&lt;/h2&gt;&#xA;&lt;h2 id=&#34;shared-リポジトリの作成&#34;&gt;shared リポジトリの作成&lt;/h2&gt;&#xA;&lt;p&gt;当時モノレポかマルチレポかまだ決まっていない段階で、取り敢えずコードシェアーが目の前の問題なので、&lt;a href=&#34;https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry&#34;&gt;Github private npm registery&lt;/a&gt; を利用して、複数箇所にコピペされていたコードをnpm packageにして、共有できました。&lt;a href=&#34;https://lerna.js.org/&#34;&gt;Lerna&lt;/a&gt; を使って、backend/frontend/共通 それぞれの package を作って複数のリポジトリに必要なロジックを該当の package 移して、更新したら、CIで新バージョンを publish と作りました。&lt;/p&gt;&#xA;&lt;p&gt;しかし、実際に運用してみたら、以下の問題点があります。&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;shared リポジトリのコードを更新したら、新しいバージョンの更新のCIを待つ必要がある&lt;/li&gt;&#xA;&lt;li&gt;プロジェクトのリポジトリのバージョンは頻繁に更新&lt;/li&gt;&#xA;&lt;li&gt;新しいエンジニアに shared リポジトリの使い方の教育&lt;/li&gt;&#xA;&lt;li&gt;ロジックが分散し、デバッグが難しい&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;これらが shared リポジトリの特徴なので、解決しづらいと認識して、今後もモノレポの方針を固めました。&lt;/p&gt;&#xA;&lt;h2 id=&#34;yarn-berry-に移行&#34;&gt;yarn berry に移行&lt;/h2&gt;&#xA;&lt;p&gt;yarn の &lt;a href=&#34;https://classic.yarnpkg.com/blog/2018/02/15/nohoist/&#34;&gt;hoist&lt;/a&gt; が workspace メインの問題点なので、hoist を解決するため、色々試してみました。まず、yarn の nohoist を利用しましたが、結果根本的に解決できません。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
